# CollageStates 功能测试清单

## 环境准备

- [x] 所有依赖已安装
- [x] 所有必需文件存在
- [x] 服务器代码语法正确
- [ ] 配置 `.env` 文件（需要 Replicate API Token）

## 功能测试

### 1. 基础功能测试

#### 1.1 页面加载
- [ ] 页面正常加载，无 JavaScript 错误
- [ ] 画布正确显示（1920x1080）
- [ ] 工具栏所有按钮可见
- [ ] 素材库面板显示

#### 1.2 用户连接
- [ ] 输入昵称和选择颜色
- [ ] 点击"连接"按钮
- [ ] 连接状态显示"已连接"
- [ ] Socket.io 连接成功

### 2. 背景生成功能

#### 2.1 生成背景
- [ ] 点击"生成背景"按钮
- [ ] 显示"生成中..."提示
- [ ] 后端成功调用 Replicate API
- [ ] 背景图加载到画布
- [ ] 按钮状态恢复正常

#### 2.2 错误处理
- [ ] 无 API Token 时显示错误
- [ ] API 调用失败时显示错误信息

### 3. 素材管理功能

#### 3.1 上传素材
- [ ] 点击"上传素材"按钮
- [ ] 选择 PNG 文件
- [ ] 上传成功提示
- [ ] 素材出现在素材库中

#### 3.2 素材列表
- [ ] 页面加载时自动获取素材列表
- [ ] 素材缩略图正确显示
- [ ] 素材名称正确显示

#### 3.3 素材选择
- [ ] 点击素材库中的素材
- [ ] 鼠标变为十字光标
- [ ] 在画布上点击放置素材
- [ ] 素材正确显示在画布上

### 4. 拼贴操作功能

#### 4.1 拖拽功能
- [ ] 点击画布上的素材
- [ ] 鼠标变为抓取光标
- [ ] 拖拽素材移动
- [ ] 素材位置正确更新
- [ ] 素材不超出画布边界

#### 4.2 删除功能
- [ ] 选中素材后按 Delete 键
- [ ] 素材从画布移除
- [ ] 素材计数正确更新

#### 4.3 层级管理
- [ ] 多个素材正确叠加
- [ ] 后添加的素材在上层

### 5. 多人互动功能

#### 5.1 用户连接
- [ ] 多个用户同时连接
- [ ] 每个用户有独立标识（昵称、颜色）

#### 5.2 操作同步
- [ ] 用户A添加素材，用户B能看到（半透明显示）
- [ ] 用户A移动素材，用户B能看到移动
- [ ] 用户A删除素材，用户B能看到删除
- [ ] 其他用户的操作显示用户标识（颜色边框、昵称）

#### 5.3 用户断开
- [ ] 用户断开连接
- [ ] 其他用户收到通知
- [ ] 断开用户的 ghost 素材被移除

### 6. 下载功能

#### 6.1 PNG 导出
- [ ] 点击"下载拼贴"按钮
- [ ] 浏览器触发下载
- [ ] 下载的文件名为 `collage-{timestamp}.png`
- [ ] 图片包含背景和所有素材
- [ ] 图片尺寸为 1920x1080

#### 6.2 透明背景
- [ ] 无背景时导出透明背景（或白色背景）
- [ ] 有背景时导出包含背景的图片

### 7. 清空功能

#### 7.1 清空画布
- [ ] 点击"清空画布"按钮
- [ ] 显示确认对话框
- [ ] 确认后清空所有素材
- [ ] 背景保留（或清空，根据实现）

### 8. 错误处理和边界情况

#### 8.1 网络错误
- [ ] API 调用失败时显示友好错误
- [ ] Socket.io 断开时显示提示

#### 8.2 文件上传
- [ ] 上传非 PNG 文件时显示错误
- [ ] 上传过大文件时显示错误
- [ ] 上传成功/失败有明确提示

#### 8.3 画布操作
- [ ] 未选择素材时点击画布不报错
- [ ] 拖拽超出边界时正确限制
- [ ] 快速连续操作不报错

## 性能测试

- [ ] 页面加载速度正常
- [ ] 素材加载不卡顿
- [ ] 多人同时操作时性能正常
- [ ] 大量素材时渲染正常

## 浏览器兼容性

- [ ] Chrome/Edge 测试
- [ ] Firefox 测试
- [ ] Safari 测试（如需要）

## 测试步骤

1. 启动服务器：`npm start`
2. 打开浏览器访问：`http://localhost:3000`
3. 打开浏览器开发者工具（F12）查看控制台
4. 按照上述清单逐项测试
5. 打开多个浏览器标签页测试多人互动

## 已知问题

（测试过程中发现的问题记录在这里）

